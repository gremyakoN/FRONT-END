<div controls>
    <ng-container *ngIf="showButtons">
        <button mat-raised-button
                *ngIf="states.user.value && (states.user.value.is_admin && ((states.user.value.hierarchy_level == 1) || (states.user.value.hierarchy_level == 4)))"
                (click)="addMember()">
            <mat-icon>person_add</mat-icon>
        </button>
        <button mat-raised-button (click)="export()">
            <mat-icon>save_alt</mat-icon>
        </button>
    </ng-container>
    <div pagination *ngIf="resultState.value && (resultState.value.count > 0)">
        <text-label id="pagination"
                    [params]="getPaginationParams()"></text-label>
        <button mat-icon-button
                (click)="prevPage()"
                [disabled]="paramsState.value.page_number == 1">
            <mat-icon>keyboard_arrow_left</mat-icon>
        </button>
        <button mat-icon-button
                (click)="nextPage()"
                [disabled]="(paramsState.value.page_number * paramsState.value.page_size) >= resultState.value.count">
            <mat-icon>keyboard_arrow_right</mat-icon>
        </button>
    </div>
</div>
<selected-members *ngIf="showSelectedMembers"></selected-members>
<mat-progress-bar [class.active]="searchingState.value" mode="indeterminate"></mat-progress-bar>
<mat-card>
    <table mat-table matSort *ngIf="resultState.value && (resultState.value.count > 0)"
           (matSortChange)="sortData($event)"
           [dataSource]="resultState.value.members" class="mat-elevation-z1">
        <ng-container *ngFor="let column of columns.value">
            <ng-container *ngIf="column == 'checkbox'" [matColumnDef]="column" sticky>
                <th mat-header-cell *matHeaderCellDef></th>
                <td mat-cell *matCellDef="let element" checkbox-cell>
                    <mat-checkbox [checked]="states.selectedMembersIDs.value.indexOf(element.id) != -1"
                                  (change)="checkboxChanged(element, $event.checked)"></mat-checkbox>
                </td>
            </ng-container>
            <ng-container *ngIf="column != 'checkbox'" [matColumnDef]="column">
                <th mat-header-cell *matHeaderCellDef mat-sort-header
                    [disabled]="sortableColumns.indexOf(column) == -1">
                    <text-label [id]="'searchResults.' + column"></text-label>
                </th>
                <ng-container [ngSwitch]="column" *matCellDef="let element">
                    <td mat-cell
                        *ngSwitchCase="'primary_organization_id'">{{states.primaryOrganizationsByID.value[element[column]] ? states.primaryOrganizationsByID.value[element[column]].name : ''}}</td>
                    <td mat-cell
                        *ngSwitchCase="'category_id'">{{states.categoriesByID.value[element[column]] ? states.categoriesByID.value[element[column]].name : ''}}</td>
                    <td mat-cell *ngSwitchCase="'status'">{{states.statusesByID.value[element[column]].name}}</td>
                    <td mat-cell *ngSwitchDefault>{{element[column]}}</td>
                </ng-container>
            </ng-container>
        </ng-container>
        <tr mat-header-row *matHeaderRowDef="columns.value"></tr>
        <tr mat-row *matRowDef="let row; columns: columns.value" (click)="rowClicked($event, row)" [class.clickable]="clickableRows"></tr>
    </table>
    <h2 class="mat-h2"
        *ngIf="!searchingState.value && resultState.value && (resultState.value.count == 0)">
        <text-label id="members.noResults"></text-label>
    </h2>
</mat-card>
